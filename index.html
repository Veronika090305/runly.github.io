<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUNLI ‚Äî –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–∫ –∏ –º–æ–ª–æ–¥—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–∫</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://lyqedngejapolcffscyk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5cWVkbmdlamFwb2xjZmZzY3lrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NzYxOTAsImV4cCI6MjA3ODU1MjE5MH0.xdRoqew8xSAmDbDtryMQBmu7vj9FBj_AQDD5cCJl-_g';
        window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    </script>
</head>
<body>
    <header>
        <h1>RUNLI</h1>
        <nav>
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a> |
            <a href="about.html">–û –Ω–∞—Å</a> |
            <a href="contact.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </nav>
    </header>

    <main>
        <!-- –ì–µ—Ä–æ–π-—Å–µ–∫—Ü–∏—è -->
        <section class="hero-section">
            <div class="hero-content">
                <h2>–¢–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤–æ –≤–∑—Ä–æ—Å–ª–æ–π –∂–∏–∑–Ω–∏</h2>
                <p class="lead">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≥–∞–π–¥—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–∫ –∏ –º–æ–ª–æ–¥—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–∫. –í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ —Å–æ–≤–µ—Ç –æ—Ç —Å—Ç–∞—Ä—à–µ–π –ø–æ–¥—Ä—É–≥–∏.</p>
            </div>
        </section>

        <!-- –ë–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <section class="auth-section">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="auth-tab" data-tab="signup">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="login-form" class="auth-form active">
                <form id="signin-form">
                    <input type="email" id="signin-email" placeholder="Email" required>
                    <input type="password" id="signin-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <div class="auth-links">
                        <button type="button" id="forgot-password" class="link">–ù–µ –ø–æ–º–Ω—é –ø–∞—Ä–æ–ª—å</button>
                    </div>
                    <button type="submit" class="auth-button">–í–æ–π—Ç–∏</button>
                </form>
                <div id="signin-msg" class="notice" style="display:none"></div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="signup-form" class="auth-form">
                <form id="register-form">
                    <input type="email" id="register-email" placeholder="Email" required>
                    <input type="password" id="register-password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)" required>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>–í–æ–∑—Ä–∞—Å—Ç</label>
                            <input type="number" id="register-age" placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç" min="14" max="100">
                        </div>
                        <div class="form-group">
                            <label>–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
                            <select id="register-activity" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                                <option value="school">–®–∫–æ–ª—å–Ω–∏–∫</option>
                                <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                                <option value="employed">–†–∞–±–æ—Ç–∞—é</option>
                                <option value="unemployed">–ù–µ —Ä–∞–±–æ—Ç–∞—é</option>
                                <option value="entrepreneur">–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</option>
                                <option value="other">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–¶–µ–ª–∏ –Ω–∞ RUNLI (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="goals" value="finance"> –§–∏–Ω–∞–Ω—Å—ã –∏ –±—é–¥–∂–µ—Ç</label>
                            <label><input type="checkbox" name="goals" value="career"> –ö–∞—Ä—å–µ—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞</label>
                            <label><input type="checkbox" name="goals" value="study"> –£—á—ë–±–∞ –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</label>
                            <label><input type="checkbox" name="goals" value="health"> –ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ</label>
                            <label><input type="checkbox" name="goals" value="organization"> –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –±—ã—Ç–∞</label>
                            <label><input type="checkbox" name="goals" value="relationships"> –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –æ–±—â–µ–Ω–∏–µ</label>
                        </div>
                    </div>

                    <div class="terms">
                        –ù–∞–∂–∏–º–∞—è ¬´–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞.
                    </div>
                    <button type="submit" class="auth-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
                <div id="signup-msg" class="notice" style="display:none"></div>
            </div>
        </section>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ -->
        <section>
            <h2>–ß—Ç–æ —Ç–µ–±—è –∂–¥—ë—Ç –≤ RUNLI</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–º</h3>
                    <p>–¢—Ä–µ–∫–µ—Ä—ã —Ä–∞—Å—Ö–æ–¥–æ–≤, —à–∞–±–ª–æ–Ω—ã –±—é–¥–∂–µ—Ç–∞, —Å–æ–≤–µ—Ç—ã –ø–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º</p>
                </div>
                <div class="feature-card">
                    <h3>üéØ –ö–∞—Ä—å–µ—Ä–∞ –∏ –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã</h3>
                    <p>–†–µ–∑—é–º–µ, —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è, –∫–∞—Ä—å–µ—Ä–Ω—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã</p>
                </div>
                <div class="feature-card">
                    <h3>üè† –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –±—ã—Ç–∞</h3>
                    <p>–ß–µ–∫-–ª–∏—Å—Ç—ã, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏, —Å–æ–≤–µ—Ç—ã –ø–æ —Ö–æ–∑—è–π—Å—Ç–≤—É</p>
                </div>
                <div class="feature-card">
                    <h3>üå± –õ–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ</h3>
                    <p>–ü—Ä–∏–≤—ã—á–∫–∏, —Ü–µ–ª–∏, —Å–∞–º–æ—Ä–µ—Ñ–ª–µ–∫—Å–∏—è</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 RUNLI. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ —Ñ–æ—Ä–º
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ –∏ —Ñ–æ—Ä–º–µ
                tab.classList.add('active');
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-form`).classList.add('active');
            });
        });

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
        document.getElementById('forgot-password').addEventListener('click', async () => {
            const email = document.getElementById('signin-email').value.trim();
            if (!email) {
                alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è');
                return;
            }

            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: `${window.location.origin}/reset-password.html`
                });
                
                if (error) throw error;
                alert('–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        });

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const age = document.getElementById('register-age').value;
            const activity = document.getElementById('register-activity').value;
            const goals = Array.from(document.querySelectorAll('input[name="goals"]:checked'))
                              .map(checkbox => checkbox.value);

            if (password.length < 6) {
                setMessage('signup-msg', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            try {
                const redirectTo = `${window.location.origin}/index.html?confirmed=1`;
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password
                }, { redirectTo });

                if (error) throw error;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø—Ä–æ—Ñ–∏–ª—å
                if (data.user) {
                    await supabase.from('profiles').upsert({
                        user_id: data.user.id,
                        age: age || null,
                        activity: activity || null,
                        goals: goals.length > 0 ? goals : null,
                        updated_at: new Date().toISOString()
                    });
                }

                setMessage('signup-msg', 'üéâ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É ‚Äî –≤—ã—Å–ª–∞–Ω–æ –ø–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!', true);
                document.getElementById('register-form').reset();
            } catch (error) {
                setMessage('signup-msg', '–û—à–∏–±–∫–∞: ' + error.message);
            }
        });

        // –í—Ö–æ–¥
        document.getElementById('signin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signin-email').value.trim();
            const password = document.getElementById('signin-password').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) throw error;

                setMessage('signin-msg', '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...', true);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                setTimeout(() => {
                    window.location.href = '/dashboard.html'; // –°–æ–∑–¥–∞–¥–∏–º –ø–æ–∑–∂–µ
                }, 1000);
            } catch (error) {
                setMessage('signin-msg', '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
            }
        });

        function setMessage(elementId, text, isSuccess = false) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.style.display = 'block';
            element.className = `notice ${isSuccess ? 'success' : ''}`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('confirmed') === '1') {
            setMessage('signin-msg', 'üéâ Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.', true);
        }
    </script>
</body>
</html>
